<%- include('partials/header', { title: 'Manage Users' }) %>
<%- include('partials/navigation', { page: 'manage-users' }) %>

<section class="section active">
    <h2>User Management</h2>
    
    <div class="search-bar">
        <form method="GET" action="/users" style="display: flex; gap: 15px; max-width: 500px;">
            <input type="text" name="search" value="<%= search %>" placeholder="Search users by username, name or email..." style="flex: 1; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem;">
            <button type="submit" class="btn-secondary">Search</button>
        </form>
    </div>
    
    <div class="students-table">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% if (users.length === 0) { %>
                    <tr>
                        <td colspan="7" class="no-data">
                            <%= search ? 'No users found matching your search' : 'No users found' %>
                        </td>
                    </tr>
                <% } else { %>
                    <% users.forEach(userItem => { %>
                        <tr>
                            <td><%= userItem.id %></td>
                            <td><%= userItem.username %></td>
                            <td><%= userItem.fullName %></td>
                            <td><%= userItem.email %></td>
                            <td>
                                <span class="status-badge status-<%= userItem.role === 'admin' ? 'graduated' : userItem.role === 'teacher' ? 'active' : 'inactive' %>">
                                    <%= userItem.role %>
                                </span>
                            </td>
                            <td><%= new Date(userItem.createdAt).toLocaleDateString() %></td>
                            <td>
                                <% if (userItem.id !== user.id) { %>
                                    <form method="POST" action="/delete-user/<%= userItem.id %>" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this user?')">
                                        <button type="submit" class="action-btn delete-btn">Delete</button>
                                    </form>
                                <% } else { %>
                                    <span style="color: #64748b; font-style: italic;">Current User</span>
                                <% } %>
                            </td>
                        </tr>
                    <% }) %>
                <% } %>
            </tbody>
        </table>
    </div>
    
    <div style="margin-top: 30px; text-align: center;">
        <a href="/register" class="btn-primary">Add New User</a>
    </div>
</section>

<%- include('partials/footer') %>
