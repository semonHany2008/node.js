<%- include('partials/header', { title: 'View Students' }) %>
<%- include('partials/navigation', { page: 'view-students' }) %>

<section class="section active">
    <h2>All Students</h2>
    
    <div class="search-bar">
        <form method="GET" action="/students" style="display: flex; gap: 15px; max-width: 500px;">
            <input type="text" name="search" value="<%= search %>" placeholder="Search students by name or email..." style="flex: 1; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem;">
            <button type="submit" class="btn-secondary">Search</button>
        </form>
    </div>
    
    <div class="students-table">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Age</th>
                    <th>Course</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% if (students.length === 0) { %>
                    <tr>
                        <td colspan="7" class="no-data">
                            <%= search ? 'No students found matching your search' : 'No students found' %>
                        </td>
                    </tr>
                <% } else { %>
                    <% students.forEach(student => { %>
                        <tr>
                            <td><%= student.id %></td>
                            <td><%= student.firstName %> <%= student.lastName %></td>
                            <td><%= student.email %></td>
                            <td><%= student.age %></td>
                            <td><%= student.course %></td>
                            <td>
                                <span class="status-badge status-<%= student.status.toLowerCase() %>">
                                    <%= student.status %>
                                </span>
                            </td>
                            <td>
                                <% if (canEdit) { %>
                                    <a href="/edit-student/<%= student.id %>" class="action-btn edit-btn">Edit</a>
                                <% } %>
                                <% if (canDelete) { %>
                                    <form method="POST" action="/delete-student/<%= student.id %>" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this student?')">
                                        <button type="submit" class="action-btn delete-btn">Delete</button>
                                    </form>
                                <% } %>
                                <% if (!canEdit && !canDelete) { %>
                                    <span style="color: #94a3b8; font-style: italic;">View Only</span>
                                <% } %>
                            </td>
                        </tr>
                    <% }) %>
                <% } %>
            </tbody>
        </table>
    </div>
</section>

<%- include('partials/footer') %>
